---
description: "Sincroniza√ß√£o de Template entre Editor e Web"
globs:
  - "apps/admin/app/(admin)/editor/**/*.tsx"
  - "apps/web/app/**/*.tsx"
  - "apps/web/components/template/**/*.tsx"
  - "apps/web/lib/templates/**/*.tsx"
  - "apps/admin/lib/templates/**/*.tsx"
  - "templates/**/*.tsx"
  - "templates/**/*.ts"
  - "templates/**/*.json"
alwaysApply: true
---

# üé® Regras de Sincroniza√ß√£o de Template entre Editor e Web

## üìã Princ√≠pio Fundamental

**O layout renderizado em `/editor` (admin) e `/` (web) deve ser EXATAMENTE IGUAL, usando o mesmo `layout.json` e os mesmos componentes do template.**

## ‚úÖ O Que Deve Ser Id√™ntico

### 1. Layout e Estrutura
- **Mesmo `layout.json`** usado por ambos (em `templates/{templateId}/layout.json`)
- **Mesmos componentes** do template (em `templates/{templateId}/index.ts`)
- **Mesma ordem** de renderiza√ß√£o dos componentes
- **Mesmas props** passadas para cada componente

### 2. Componentes do Template
- Componentes em `apps/web/components/template/{templateId}/` s√£o a **fonte √∫nica de verdade**
- O editor carrega esses mesmos componentes atrav√©s de `templates/{templateId}/index.ts`
- **NUNCA** criar vers√µes diferentes dos componentes para admin ou web

### 3. Renderiza√ß√£o
- **Editor (`/editor`)**: Usa Craft.js para deserializar e renderizar o `layout.json`
- **Web (`/`)**: Usa `TemplateLayoutRenderer` para renderizar o mesmo `layout.json` sem Craft.js
- Ambos devem produzir **exatamente o mesmo resultado visual**

## üîÑ Como Funciona a Sincroniza√ß√£o

### Editor (`apps/admin/app/(admin)/editor/page.tsx`)
```typescript
// Carrega layout.json e componentes do template
const layout = await loadTemplateLayout(templateId)
const resolver = await loadTemplateComponents(templateId)

// Usa Craft.js para deserializar e renderizar
<Editor resolver={resolver}>
  <Frame /> {/* Renderiza o layout.json */}
</Editor>
```

### Web (`apps/web/components/template/flor-de-menina-template.tsx`)
```typescript
// Usa o mesmo layout.json e componentes
<TemplateLayoutRenderer templateId="flor-de-menina" />
// Renderiza o layout.json sem Craft.js, mas com os mesmos componentes
```

## üö´ O Que NUNCA Deve Divergir

### Proibido:
- ‚ùå Criar componentes diferentes para editor e web
- ‚ùå Modificar o `layout.json` em apenas um lugar
- ‚ùå Adicionar props diferentes entre editor e web
- ‚ùå Alterar a ordem dos componentes no layout
- ‚ùå Criar l√≥gica de renderiza√ß√£o diferente
- ‚ùå Usar componentes diferentes para o mesmo prop√≥sito

## üìê Estrutura Esperada

### Layout JSON (Fonte √önica)
```
templates/flor-de-menina/layout.json
```
- Define a estrutura completa do template
- Usado por **ambos** editor e web
- **NUNCA** modificar diretamente sem atualizar ambos os renderizadores

### Componentes do Template (Fonte √önica)
```
apps/web/components/template/flor-de-menina/components/
templates/flor-de-menina/index.ts (exporta os componentes)
```
- Componentes React reais
- Exportados atrav√©s de `templates/{templateId}/index.ts`
- Carregados dinamicamente pelo editor e web

### Renderizadores
```
apps/admin/app/(admin)/editor/page.tsx (usa Craft.js)
apps/web/lib/templates/template-layout-renderer.tsx (renderiza√ß√£o direta)
```
- Ambos usam o mesmo `layout.json`
- Ambos usam os mesmos componentes
- Produzem o mesmo resultado

## üõ†Ô∏è Manuten√ß√£o

### Ao Modificar o Layout:
1. **Modificar apenas** `templates/{templateId}/layout.json`
2. **Ambos** editor e web usar√£o automaticamente o novo layout
3. **Testar** que ambos renderizam igual

### Ao Modificar um Componente do Template:
1. **Modificar apenas** o componente em `apps/web/components/template/{templateId}/components/`
2. O componente √© exportado atrav√©s de `templates/{templateId}/index.ts`
3. **Ambos** editor e web usar√£o automaticamente o componente atualizado
4. **Testar** que ambos renderizam igual

### Ao Adicionar um Novo Componente:
1. Criar o componente em `apps/web/components/template/{templateId}/components/`
2. Exportar em `templates/{templateId}/index.ts`
3. Adicionar ao `componentResolver` em `templates/{templateId}/index.ts`
4. Adicionar ao `layout.json` se necess√°rio
5. **Testar** que ambos editor e web renderizam corretamente

## üîç Checklist de Sincroniza√ß√£o

Ao modificar qualquer parte do template, verificar:

- [ ] O `layout.json` est√° atualizado?
- [ ] Os componentes est√£o exportados corretamente em `templates/{templateId}/index.ts`?
- [ ] O editor renderiza corretamente em `/editor`?
- [ ] A web renderiza corretamente em `/`?
- [ ] Ambos produzem o mesmo resultado visual?
- [ ] N√£o h√° componentes duplicados ou diferentes?

## üìù Exemplo de Viola√ß√£o

### ‚ùå ERRADO:
```typescript
// apps/web/components/template/flor-de-menina-template.tsx
export function FlorDeMeninaTemplate() {
  return (
    <div>
      <Header />
      <CustomHero /> {/* ‚ùå Componente diferente! */}
      <Footer />
    </div>
  )
}

// Editor usa layout.json que tem HeroBanner, n√£o CustomHero
// Resultado: layouts diferentes!
```

### ‚úÖ CORRETO:
```typescript
// apps/web/components/template/flor-de-menina-template.tsx
export function FlorDeMeninaTemplate() {
  return (
    <TemplateLayoutRenderer templateId="flor-de-menina" />
    // ‚úÖ Usa o mesmo layout.json que o editor
  )
}

// Editor tamb√©m usa o mesmo layout.json
// Resultado: layouts id√™nticos!
```

## üéØ Objetivo Final

**Garantir que o preview no editor (`/editor`) seja uma representa√ß√£o 100% fiel do que ser√° renderizado no site do cliente (`/`), eliminando surpresas e inconsist√™ncias entre desenvolvimento e produ√ß√£o.**

## ‚ö†Ô∏è Regra de Ouro

**SEMPRE que modificar:**
- Um componente do template ‚Üí Verificar que ambos editor e web usam o mesmo
- O `layout.json` ‚Üí Verificar que ambos renderizam igual
- A estrutura do template ‚Üí Verificar que ambos est√£o sincronizados

**NUNCA criar vers√µes diferentes do mesmo componente ou layout para editor e web.**
